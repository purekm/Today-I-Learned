<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make Webhook Trigger</title>
</head>
<body>
    <h1>Make Webhook ì‹¤í–‰</h1>
    <button onclick="callAWSLambda()">ì›¹í›… ì‹¤í–‰</button>

    <form>
      <input type="text" id="userIdInput" placeholder="ì‚¬ìš©ì ID ì…ë ¥">
      <input type="text" id="usernameInput" placeholder="ì‚¬ìš©ì ì´ë¦„ ì…ë ¥">
      <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
      <input type="email" id="emailInput" placeholder="ì´ë©”ì¼ ì…ë ¥">
      <input type="text" id="phoneNumberInput" placeholder="ì „í™”ë²ˆí˜¸ ì…ë ¥">
      <button type="button" onclick="saveToDatabase()">íšŒì›ê°€ì…</button>
    </form>

    
    <h2>ë§ˆì´í˜ì´ì§€</h2>
    <input type="text" id="searchUserIdInput" placeholder="ì¡°íšŒí•  ì‚¬ìš©ì ID ì…ë ¥">
    <button type="button" onclick="getUserData()">ë§ˆì´í˜ì´ì§€ ì¡°íšŒ</button>

    <h3>ì‚¬ìš©ì ì •ë³´</h3>
    <div id="userDataDisplay">ë°ì´í„° ì—†ìŒ</div>

    <script>
      // ì›¹í›… ì‹¤í–‰ í•¨ìˆ˜
      function callAWSLambda() {
        fetch("https://r1qvanbo4b.execute-api.ap-northeast-2.amazonaws.com/default/hooktest", { 
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ trigger: "button_click" }) // ì›¹í›… ì‹¤í–‰
        })
        .then(response => response.json())
        .then(data => console.log("Webhook Response:", data))
        .catch(error => console.error("Webhook Error:", error));
      }

      // DB ì €ì¥ í•¨ìˆ˜
      function saveToDatabase() {
        const userId = document.getElementById("userIdInput").value;
        const username = document.getElementById("usernameInput").value;
        const password = document.getElementById("passwordInput").value;
        const email = document.getElementById("emailInput").value;
        const phoneNumber = document.getElementById("phoneNumberInput").value;
    
        // ìš”ì²­ ë°ì´í„° êµ¬ì„±
        const requestData = JSON.stringify({
            id: userId,
            username: username,
            password: password,  // ì„œë²„ì—ì„œ í•´ì‹±ë¨
            email: email,
            phone_number: phoneNumber
        });
    
        console.log("ğŸ“Œ ìš”ì²­ ë°ì´í„°:", requestData);
    
        // API Gatewayë¡œ ìš”ì²­ ì „ì†¡
        fetch("https://q8kbesh6e6.execute-api.ap-northeast-2.amazonaws.com/default/datainput", { 
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: requestData 
        })
        .then(response => response.json())
        .then(data => console.log("âœ… DB Response:", data))
        .catch(error => console.error("âŒ DB Error:", error));
    }


    // DB ì¡°íšŒ í•¨ìˆ˜ (ë§ˆì´í˜ì´ì§€ ì¡°íšŒ)
      function getUserData() {
        const searchUserId = document.getElementById("searchUserIdInput").value;

        if (!searchUserId) {
            alert("ì¡°íšŒí•  ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
            return;
        }

        fetch(`https://q8kbesh6e6.execute-api.ap-northeast-2.amazonaws.com/default/datainput?id=${searchUserId}`, {
            method: "GET",
            headers: { "Content-Type": "application/json" }
        })
        .then(response => response.json())
        .then(data => {
            console.log("âœ… ì‚¬ìš©ì ë°ì´í„°:", data);
            if (data.error) {
                document.getElementById("userDataDisplay").innerHTML = `<p>âŒ ì˜¤ë¥˜: ${data.error}</p>`;
            } else {
                document.getElementById("userDataDisplay").innerHTML = `
                    <p><strong>ID:</strong> ${data.id}</p>
                    <p><strong>ì´ë¦„:</strong> ${data.username}</p>
                    <p><strong>ì´ë©”ì¼:</strong> ${data.email}</p>
                    <p><strong>ì „í™”ë²ˆí˜¸:</strong> ${data.phone_number}</p>
                    <p><strong>ê°€ì…ì¼:</strong> ${data.created_at}</p>
                `;
            }
        })
        .catch(error => console.error("âŒ DB ì¡°íšŒ ì˜¤ë¥˜:", error));
      }
    </script>
</body>
</html>
