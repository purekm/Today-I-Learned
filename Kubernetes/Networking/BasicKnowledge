Switching
Switch: L2 레이어에서 Mac 주소 기반으로, 같은 네트워크 내에서 전달학기 위한 장비
Router: L3 레이어에서 IP 주소 기반으로, 서로 다른 네트워크 간에 전달하기 위한 장비

command
ip link - 네트워크 인터페이스 목록 확인
ip addr add - 네트워크 인터페이스에 IP 주소 할당
route - 라우팅 테이블 설정 및 확인
(gateway는 Router IP 주소)
ip route add destination via gateway IP

router가 있지만 gateway가 없으면 다른 네트워크로 보낼 수 없음. Why?
=> gateway는 router의 IP로, 이를 모르면 ARP로 router의 Mac을 못 찾음.
=> router의 Mac을 모르면 L2 레이어에서 패킷을 전달할 수 없음. 

linux host를 router로 설정하는 법
A <-> B <-> C 가 소통하고 있을때, A->C로 소통하려면 어떻게 해야하나?
=> A->B->C 로 가야함. A의 라우팅 테이블에 C로 가는 경로를 B를 통해서 간다는 것을 설정해줘야함.
=> C에서 응답할 때도 똑같이 C->B->A 로 가야하므로, C의 라우팅 테이블에도 A로 가는 경로를 B를 통해서 간다는 것을 설정해줘야함.

ipforwarding 활성화
  echo 1 > /proc/sys/net/ipv4/ip_forward로 활성화시키면 proxy 역할을 할 수 있음.
  재부팅시 초기화되므로, 영구적으로 설정하려면 /etc/sysctl.conf 파일에 net.ipv4.ip_forward=1 추가


DNS
192.168.1.11이 db인데 ping db를 하기 위해서는 /etc/hosts 파일에 작성해줘야 함 (Name Resolution)
여러 IP를 도메인 네임에 매핑하려면 DNS 서버 필요
DNS 서버: 도메인 네임을 IP 주소로 변환해주는 서버 (/etc/resolv.conf 파일에 DNS 서버 IP 작성)
Host에 있는 host와 DNS 서버의 host가 이름이 같은데 IP 주소가 다르면 어떻게 하나?
=> 기본적으로는 Host의 /etc/hosts 파일이 우선순위가 더 높음. 따라서 Host의 /etc/hosts 파일에 있는 IP 주소로 변환됨.
=> DNS 서버의 host 파일을 우선순위 높게 설정 가능 (예: nsswitch.conf 파일에서 hosts 항목 수정)

컨테이너가 생성되면 컨테이너에 대한 network namespace가 생성됨.
컨테이너는 자체 가상 인터페이스와  라우팅 테이블을 가짐.

namespace에 여러개의 컨테이너가 있을 때 각각의 인터페이스 확인하는 법
ip link: 모든 네트워크 인터페이스 확인
ip netns exec <namespace 이름> ip link: 특정 네트워크 네임스페이스 내의 네트워크 인터페이스 확인
= ip -n <namespace 이름> link 

호스트는 관리자로서 네임스페이스 안의 모든 리소스를 확인할 수 있음
하지만 네임스페이스 안에서는 호스트의 리소스를 확인할 수 없음(격리)

네임스페이스간 연결성 설정
파이프 or 가상 케이블이라고 불리는 veth(virtual ethernet) 인터페이스 사용
1. 케이블 생성 
- ip link add veth-red type veth peer name veth-blue

2. 각 ip link를 적절한 네이틈스페이스에 할당
- ip link set veth-red netns red
- ip link set veth-blue netns blue

3. 각 네임스페이스 안에서 ip 주소 할당 
- ip -n red addr add 192.~ dev veth-red
- ip -n blue addr add 192.~ dev veth-blue
(dev는 인터페이스에 뭔가 할당할 때 사용)

4. 각 네임스페이스 안에서 인터페이스 활성화
- ip -n red link set veth-red up
- ip -n blue link set veth-blue up 

사람이 많으면 어떻게하나?
=> 각각 peer 연결을 할 순 없음
=> 가상 Switch 생성 해서 네트워크를 스위치에 연결
=> 어떻게 가상 스위치 생성?
Linux Bridge 사용

- ip link add v-net-0 type bridge
(host에겐 하나의 인터페이스에 불과함)
- ip link set v-net-0 up
(브릿지 인터페이스 활성화)

프라이빗한 주소들과 외부 IP가 소통하려면 어떻게 해야함?
=> NAT 사용
=> iptables 사용 iptable -t nat -A POSTROUTING -s <프라이빗 네트워크 대역> -o <외부 인터페이스> 